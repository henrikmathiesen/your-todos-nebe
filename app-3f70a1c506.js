angular.module("backend",["ngMockE2E"]).run(["$httpBackend","backendFactory",function(o,t){var e={headers:{"Content-Type":"application/json"}};o.whenGET("/api/todos").respond(function(){var o=t.getTodos();return[200,o,e]}),o.whenPOST("/api/todo").respond(function(o,n,d){var r=angular.fromJson(d),a=t.addTodo(r);return[201,a,e]}),o.whenPUT(/\/api\/todo\/\d+/).respond(function(o,n,d){var r=n.split("/")[3],a=angular.fromJson(d),c=t.updateTodo(r,a),u=c?200:404;return[u,c,e]}),o.whenDELETE(/\/api\/todo\/\d+/).respond(function(o,e,n){var d=e.split("/")[3],r=t.deleteTodo(d),a=r?204:404;return[a,{},{}]})}]),angular.module("shared",[]),$(function(){FastClick.attach(document.body)}),angular.module("main",["templatecache","backend","todos","shared"]),angular.module("todos",[]),angular.module("backend").factory("backendFactory",["initialDataFactory","utilsFactory","localstorageFactory",function(o,t,e){var n={},d="yourTodos",r=o.getTodos();return e.isEmpty(d)?e.set(d,r):r=e.get(d),n.getTodos=function(){return r},n.addTodo=function(o){return o.id=t.getNewId(r),r.push(o),o},n.updateTodo=function(o,t){var n=r.map(function(o){return o.id.toString()}).indexOf(o.toString());return n<0?null:(r.splice(n,1,t),e.set(d,r),t)},n.deleteTodo=function(o){for(var t=!1,n=0;n<r.length;n++)if(r[n].id==o){t=!0,r.splice(n,1);break}return e.set(d,r),t},n}]),angular.module("backend").factory("initialDataFactory",function(){var o={},t=[{id:1,text:"Keep up with front end stuff"},{id:2,text:"Assemble a tshirt gun"},{id:3,text:"Make sure there are an equal amount of blue berries in each muffin"},{id:4,text:"Juggle and fail"},{id:5,text:"Study Angular"},{id:6,text:"Study React"},{id:7,text:"Lorem ipsum dolores"}];return o.getTodos=function(){return t},o}),angular.module("backend").factory("localstorageFactory",["$window",function(o){var t={};return t.set=function(t,e){var n=angular.toJson(e);o.localStorage.setItem(t,n)},t.get=function(t){var e=o.localStorage.getItem(t);return angular.fromJson(e)},t.isEmpty=function(t){return null===o.localStorage.getItem(t)},t}]),angular.module("backend").factory("utilsFactory",function(){var o={};return o.getNewId=function(o){if(!o.length)return 1;var t=o.map(function(o){return o.id}),e=t.sort(function(o,t){return o-t});return e.pop()+1},o}),angular.module("shared").factory("errorHandlerFactory",function(){var o={},t=!1;return o.getAppHasError=function(){return t},o.setAppHasError=function(o){t=o},o}),angular.module("shared").directive("ytError",["$timeout","errorHandlerFactory",function(o,t){return{restrict:"E",scope:{},templateUrl:"shared/yt-error.template.html",replace:!0,link:function(e,n){e.vm={showError:!1,ok:function(){t.setAppHasError(!1)}};var d=function(t){o(function(){e.vm.showError=t})};e.$watch(t.getAppHasError,function(o,t){if(o===!0)n.fadeIn(function(){d(!0)});else{if(o===t)return;n.fadeOut(function(){d(!1)})}})}}}]),angular.module("todos").directive("ytTodos",function(){return{restrict:"E",scope:{},templateUrl:"todos/yt-todos.template.html",replace:!0,controller:"ytTodosController as vm",bindToController:!0}}).controller("ytTodosController",["todosCrudFactory","todosEffectFactory",function(o,t){var e=this;e.todos=[],e.allTodosChecked=!1,e.noTodosChecked=!0;var n=function(){o.getTodos().then(function(o){e.todos=o})};e.isAllTodosChecked=function(){t.isAllTodosChecked(e)},e.checkAllTodos=function(o){t.checkAllTodos(e,o)},e.addTodo=function(){var o={id:null,text:""};t.addTodo(e,o)},e.updateCheckedTodos=function(){t.updateCheckedTodos(e)},e.deleteCheckedTodos=function(){t.deleteCheckedTodos(e)},n()}]),angular.module("todos").factory("todosApiFactory",["$http",function(o){var t={};return t.getTodos=function(){return o.get("/api/todos")},t.addTodo=function(t){return o.post("/api/todo",t)},t.updateTodo=function(t){return o.put("/api/todo/"+t.id,t)},t.deleteTodo=function(t){return o.delete("/api/todo/"+t)},t}]),angular.module("todos").factory("todosCrudFactory",["$q","todosApiFactory","errorHandlerFactory",function(o,t,e){var n={},d=function(t){return e.setAppHasError(!0),o.reject()},r=function(o){return o.data};return n.getTodos=function(){return t.getTodos().then(r).catch(d)},n.addTodo=function(o){var e={id:o.id,text:o.text};return t.addTodo(e).then(r).catch(d)},n.updateTodo=function(o){var e={id:o.id,text:o.text};return t.updateTodo(e).then(r).catch(d)},n.deleteTodo=function(o){return t.deleteTodo(o).then(r).catch(d)},n}]),angular.module("todos").factory("todosEffectFactory",["todosCrudFactory","$q","$timeout",function(o,t,e){var n={};n.isAllTodosChecked=function(o){return o.todos.length?(o.allTodosChecked=o.todos.every(function(o){return o.checked}),void(o.noTodosChecked=!o.todos.some(function(o){return o.checked}))):(o.allTodosChecked=!1,void(o.noTodosChecked=!0))},n.checkAllTodos=function(o,t){o.todos.map(function(o){o.checked=t,o.isInEditMode=t}),n.isAllTodosChecked(o)},n.addTodo=function(t,e){o.addTodo(e).then(function(o){t.todos.push(o),n.setCheckedAndEditMode(t,o.id),n.isAllTodosChecked(t),n.setFocus(o.id)})},n.updateCheckedTodos=function(e){var d=[],r=[],a=function(){var o=e.todos.filter(function(o){return o.checked===!0});angular.forEach(o,function(o){n.unSetCheckedAndEditMode(e,o.id)}),n.isAllTodosChecked(e)},c=function(){angular.forEach(d,function(o){o.fadeTo(100,.1).fadeTo(200,1)}),a()};angular.forEach(e.todos,function(t){t.checked&&(d.push(angular.element("div[data-todo-id="+t.id+"]")),r.push(o.updateTodo(t)))}),t.all(r).then(c)},n.deleteCheckedTodos=function(e){var d=[],r=[],a=[],c=function(){e.todos=e.todos.filter(function(o){return o.checked!==!0}),n.isAllTodosChecked(e)},u=function(){angular.forEach(d,function(o){a.push(o.fadeOut().promise())}),t.all(a).then(c)};angular.forEach(e.todos,function(t){t.checked&&(d.push(angular.element("div[data-todo-id="+t.id+"]")),r.push(o.deleteTodo(t.id)))}),t.all(r).then(u)};var d=function(o,t,e){o.todos.map(function(o){o.id==t&&(o.checked=e,o.isInEditMode=e)})};return n.setCheckedAndEditMode=function(o,t){d(o,t,!0)},n.unSetCheckedAndEditMode=function(o,t){d(o,t,!1)},n.setFocus=function(o){e(function(){var t=angular.element('div[data-todo-id="'+o+'"]').find("input");t.focus()},0)},n}]),angular.module("todos").directive("ytTodo",function(){return{restrict:"E",scope:{},templateUrl:"todos/todo/yt-todo.template.html",replace:!0,controller:"ytTodoController as subVm",bindToController:{todo:"=",isAllTodosChecked:"&"}}}).controller("ytTodoController",["todosEffectFactory",function(o){var t=this;t.checkTodo=function(e){t.todo.checked=e,t.todo.isInEditMode=e,t.isAllTodosChecked(),o.setFocus(t.todo.id)}}]);